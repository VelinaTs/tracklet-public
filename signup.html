<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <link rel="icon" type="image/x-icon" href="/tracklet-public/favicon.ico">
  <link rel="icon" type="image/svg+xml" href="/tracklet-public/favicon.svg">
  <link rel="icon" type="image/png" sizes="16x16" href="/tracklet-public/icon16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/tracklet-public/icon32.png">
  <!-- ==================== BASIC META & SEO ==================== -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sign Up â€“ Tracklet</title>
  <meta name="description" content="Create your Tracklet account to start tracking competitor prices in real-time. Get started with a 14-day free trial."/>
  <base href="/tracklet-public/">

  <!-- Favicon & App Icons -->
  <link rel="icon" href="/favicon.ico"/>
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/>
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    /* ==================== CSS VARIABLES ==================== */
    :root {
      /* Light theme */
      --primary: #2563eb;
      --primary-light: #3b82f6;
      --primary-dark: #1e40af;
      --primary-darker: #172554;
      --accent: #8b5cf6;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --dark: #0f172a;
      --gray-50: #f8fafc;
      --gray-100: #f1f5f9;
      --gray-200: #e2e8f0;
      --gray-300: #cbd5e1;
      --gray-400: #94a3b8;
      --gray-500: #64748b;
      --gray-600: #475569;
      --gray-700: #334155;
      --gray-800: #1e293b;
      --gray-900: #0f172a;

      --bg: var(--gray-50);
      --bg-secondary: white;
      --text: var(--gray-900);
      --text-secondary: var(--gray-600);
      --border: var(--gray-200);
      --card-bg: white;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.08), 0 2px 4px -2px rgba(0,0,0,0.05);
      --shadow-lg: 0 20px 25px -5px rgba(0,0,0,0.08), 0 8px 10px -6px rgba(0,0,0,0.04);
      --shadow-xl: 0 25px 50px -12px rgba(0,0,0,0.15);
      --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
    }

    [data-theme="dark"] {
      /* Dark theme */
      --bg: #0a0f1a;
      --bg-secondary: #131c2e;
      --text: #f1f5f9;
      --text-secondary: #94a3b8;
      --border: #1e293b;
      --card-bg: #151f32;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.5);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.4);
      --shadow-lg: 0 20px 40px rgba(0,0,0,0.5);
      --shadow-xl: 0 25px 60px rgba(0,0,0,0.6);
    }

    /* ==================== BASE STYLES ==================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      line-height: 1.7;
      color: var(--text);
      background: var(--bg);
      transition: background 0.4s ease, color 0.4s ease;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
    }

    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 1.5rem;
    }

    h1, h2, h3 {
      font-weight: 700;
      line-height: 1.2;
      color: var(--text);
    }

    /* ==================== NAVIGATION ==================== */
    nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(248, 250, 252, 0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(226, 232, 240, 0.5);
      z-index: 1000;
      transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    }

    [data-theme="dark"] nav {
      background: rgba(10, 15, 26, 0.85);
      border-bottom: 1px solid rgba(30, 41, 59, 0.5);
    }

    .nav-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 80px;
    }

    .logo {
      font-size: 1.75rem;
      font-weight: 800;
      letter-spacing: -0.03em;
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-decoration: none;
    }

    [data-theme="dark"] .logo {
      background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .theme-toggle {
      background: none;
      border: none;
      font-size: 1.4rem;
      cursor: pointer;
      color: var(--text-secondary);
      transition: transform 0.3s ease, color 0.2s ease;
      padding: 0.5rem;
    }

    .theme-toggle:hover {
      color: var(--primary);
      transform: scale(1.15);
    }

    /* ==================== AUTH CONTAINER ==================== */
    .auth-page {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 6rem 1.5rem 3rem;
      background: linear-gradient(135deg, var(--bg) 0%, #f0f9ff 50%, #e0f2fe 100%);
      position: relative;
      overflow: hidden;
    }

    .auth-page::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -20%;
      width: 80%;
      height: 150%;
      background: radial-gradient(circle, rgba(37, 99, 235, 0.08) 0%, transparent 60%);
      pointer-events: none;
    }

    .auth-page::after {
      content: '';
      position: absolute;
      bottom: -30%;
      left: -20%;
      width: 60%;
      height: 100%;
      background: radial-gradient(circle, rgba(139, 92, 246, 0.06) 0%, transparent 50%);
      pointer-events: none;
    }

    [data-theme="dark"] .auth-page {
      background: linear-gradient(135deg, #0a0f1a 0%, #131c2e 50%, #1a1f35 100%);
    }

    [data-theme="dark"] .auth-page::before {
      background: radial-gradient(circle, rgba(37, 99, 235, 0.15) 0%, transparent 60%);
    }

    [data-theme="dark"] .auth-page::after {
      background: radial-gradient(circle, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
    }

    .auth-card {
      background: var(--card-bg);
      border-radius: 1.5rem;
      padding: 3rem;
      width: 100%;
      max-width: 460px;
      box-shadow: var(--shadow-xl);
      border: 1px solid var(--border);
      position: relative;
      z-index: 1;
      animation: fadeInUp 0.6s ease forwards;
    }

    .auth-header {
      text-align: center;
      margin-bottom: 2.5rem;
    }

    .auth-header h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      letter-spacing: -0.02em;
    }

    .auth-header p {
      color: var(--text-secondary);
      font-size: 0.95rem;
    }

    .auth-header p a {
      color: var(--primary);
      font-weight: 600;
      text-decoration: none;
      transition: opacity 0.2s ease;
    }

    .auth-header p a:hover {
      opacity: 0.8;
    }

    /* ==================== FORM STYLES ==================== */
    .form-group {
      margin-bottom: 1.5rem;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text);
      font-size: 0.9rem;
    }

    .input-wrapper {
      position: relative;
    }

    input[type="email"],
    input[type="password"],
    input[type="text"] {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 2px solid var(--border);
      border-radius: 0.75rem;
      font-size: 0.95rem;
      font-family: inherit;
      background: var(--bg-secondary);
      color: var(--text);
      transition: all 0.3s ease;
      outline: none;
      cursor: text;
      position: relative;
    }

    input[type="email"]:hover,
    input[type="password"]:hover,
    input[type="text"]:hover {
      border-color: var(--primary-light);
      cursor: pointer;
    }

    input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
      cursor: text;
    }

    input::placeholder {
      color: var(--gray-400);
    }

    .error-message {
      color: var(--danger);
      font-size: 0.85rem;
      margin-top: 0.5rem;
      display: none;
    }

    .error-message.show {
      display: block;
    }

    .password-strength {
      margin-top: 0.5rem;
      font-size: 0.85rem;
    }

    .strength-meter {
      height: 4px;
      background: var(--gray-200);
      border-radius: 2px;
      overflow: hidden;
      margin-top: 0.5rem;
    }

    .strength-meter-fill {
      height: 100%;
      transition: all 0.3s ease;
      border-radius: 2px;
    }

    .strength-weak { width: 33%; background: var(--danger); }
    .strength-medium { width: 66%; background: var(--warning); }
    .strength-strong { width: 100%; background: var(--success); }

    .password-requirements {
      margin-top: 0.75rem;
      padding: 0.75rem;
      background: var(--gray-50);
      border-radius: 0.5rem;
      font-size: 0.85rem;
      display: none;
    }

    [data-theme="dark"] .password-requirements {
      background: var(--bg-secondary);
    }

    .password-requirements.show {
      display: block;
    }

    .password-requirements ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .password-requirements li {
      padding: 0.25rem 0;
      color: var(--text-secondary);
    }

    .password-requirements li.valid {
      color: var(--success);
    }

    .password-requirements li::before {
      content: 'â—‹ ';
      margin-right: 0.5rem;
    }

    .password-requirements li.valid::before {
      content: 'âœ“ ';
    }

    /* ==================== BUTTONS ==================== */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.875rem 1.75rem;
      border-radius: 0.75rem;
      font-weight: 600;
      font-size: 0.95rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      border: none;
      width: 100%;
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(37, 99, 235, 0.25);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-google {
      background: white;
      color: var(--gray-700);
      border: 2px solid var(--border);
      box-shadow: var(--shadow-sm);
    }

    [data-theme="dark"] .btn-google {
      background: var(--bg-secondary);
      color: var(--text);
    }

    .btn-google:hover {
      background: var(--gray-50);
      border-color: var(--gray-300);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    [data-theme="dark"] .btn-google:hover {
      background: var(--card-bg);
      border-color: var(--border);
    }

    .btn-google svg {
      width: 20px;
      height: 20px;
    }

    .divider {
      display: flex;
      align-items: center;
      text-align: center;
      margin: 2rem 0;
      color: var(--text-secondary);
      font-size: 0.85rem;
    }

    .divider::before,
    .divider::after {
      content: '';
      flex: 1;
      border-bottom: 1px solid var(--border);
    }

    .divider span {
      padding: 0 1rem;
    }

    .terms {
      text-align: center;
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-top: 1.5rem;
    }

    .terms a {
      color: var(--primary);
      text-decoration: none;
      transition: opacity 0.2s ease;
    }

    .terms a:hover {
      opacity: 0.8;
    }

    /* ==================== LOADING STATE ==================== */
    .btn.loading {
      pointer-events: none;
      opacity: 0.7;
    }

    .btn.loading::after {
      content: '';
      position: absolute;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ==================== RESPONSIVE ==================== */
    @media (max-width: 768px) {
      .auth-card {
        padding: 2rem 1.5rem;
      }

      .auth-header h1 {
        font-size: 1.75rem;
      }
    }
  </style>
</head>
<body>
  <!-- ==================== NAVIGATION ==================== -->
  <nav>
    <div class="container">
      <div class="nav-container">
        <a href="index.html" class="logo">Tracklet</a>
        <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
          <span class="theme-icon">ðŸŒ™</span>
        </button>
      </div>
    </div>
  </nav>

  <!-- ==================== AUTH PAGE ==================== -->
  <div class="auth-page">
    <div class="auth-card">
      <div class="auth-header">
        <h1>Create your account</h1>
        <p>Already have an account? <a href="login.html">Sign in</a></p>
      </div>

      <!-- Google OAuth -->
      <button type="button" class="btn btn-google" id="googleSignup">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
          <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
          <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
          <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
        </svg>
        Continue with Google
      </button>

      <div class="divider">
        <span>or</span>
      </div>

      <!-- Email/Password Form -->
      <form id="signupForm">
        <div class="form-group">
          <label for="name">Full Name</label>
          <input 
            type="text" 
            id="name" 
            name="name" 
            placeholder="Your Name" 
            required
            autocomplete="name"
          />
          <div class="error-message" id="nameError"></div>
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input 
            type="email" 
            id="email" 
            name="email" 
            placeholder="you@example.com" 
            required
            autocomplete="email"
          />
          <div class="error-message" id="emailError"></div>
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <input 
            type="password" 
            id="password" 
            name="password" 
            placeholder="Create a strong password" 
            required
            autocomplete="new-password"
          />
          <div class="strength-meter">
            <div class="strength-meter-fill" id="strengthMeter"></div>
          </div>
          <div class="password-requirements" id="passwordRequirements">
            <ul>
              <li id="req-length">At least 8 characters</li>
              <li id="req-uppercase">One uppercase letter</li>
              <li id="req-lowercase">One lowercase letter</li>
              <li id="req-number">One number</li>
            </ul>
          </div>
          <div class="error-message" id="passwordError"></div>
        </div>

        <button type="submit" class="btn btn-primary">
          Create account
        </button>

        <div class="error-message" id="formError" style="margin-top: 1rem; text-align: center;"></div>
      </form>

      <div class="terms">
        By signing up, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>
      </div>
    </div>
  </div>

  <script src="auth.v4.js?v=4"></script>
  <script>
    const API_URL = 'https://price-monitor-backend-production-e326.up.railway.app';
    const PROJECT_BASE = '/tracklet-public';
    // Path guard: ensure we stay under the project site path
    if (!window.location.pathname.startsWith(PROJECT_BASE)) {
      const page = window.location.pathname.split('/').pop() || 'signup.html';
      window.location.replace(`${window.location.origin}${PROJECT_BASE}/${page}`);
    }
    // ==================== THEME TOGGLE ====================
    const themeToggle = document.getElementById('themeToggle');
    const html = document.documentElement;
    const themeIcon = document.querySelector('.theme-icon');

    // Check for saved theme preference or default to 'light'
    const currentTheme = localStorage.getItem('theme') || 'light';
    html.setAttribute('data-theme', currentTheme);
    themeIcon.textContent = currentTheme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';

    themeToggle.addEventListener('click', () => {
      const newTheme = html.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      html.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      themeIcon.textContent = newTheme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
    });

    // ==================== FORM VALIDATION ====================
    const signupForm = document.getElementById('signupForm');
    const nameInput = document.getElementById('name');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const nameError = document.getElementById('nameError');
    const emailError = document.getElementById('emailError');
    const passwordError = document.getElementById('passwordError');
    const formError = document.getElementById('formError');
    const googleSignupBtn = document.getElementById('googleSignup');
    const strengthMeter = document.getElementById('strengthMeter');
    const passwordRequirements = document.getElementById('passwordRequirements');

    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }

    function checkPasswordStrength(password) {
      const requirements = {
        length: password.length >= 8,
        uppercase: /[A-Z]/.test(password),
        lowercase: /[a-z]/.test(password),
        number: /[0-9]/.test(password)
      };

      // Update UI
      document.getElementById('req-length').classList.toggle('valid', requirements.length);
      document.getElementById('req-uppercase').classList.toggle('valid', requirements.uppercase);
      document.getElementById('req-lowercase').classList.toggle('valid', requirements.lowercase);
      document.getElementById('req-number').classList.toggle('valid', requirements.number);

      // Calculate strength
      const score = Object.values(requirements).filter(Boolean).length;
      
      strengthMeter.className = 'strength-meter-fill';
      if (score === 0 || password.length === 0) {
        strengthMeter.style.width = '0';
      } else if (score <= 2) {
        strengthMeter.classList.add('strength-weak');
      } else if (score === 3) {
        strengthMeter.classList.add('strength-medium');
      } else {
        strengthMeter.classList.add('strength-strong');
      }

      return score === 4;
    }

    function showError(element, message) {
      element.textContent = message;
      element.classList.add('show');
    }

    function clearError(element) {
      element.textContent = '';
      element.classList.remove('show');
    }

    nameInput.addEventListener('input', () => clearError(nameError));
    emailInput.addEventListener('input', () => clearError(emailError));
    passwordInput.addEventListener('input', () => {
      clearError(passwordError);
      checkPasswordStrength(passwordInput.value);
    });

    passwordInput.addEventListener('focus', () => {
      passwordRequirements.classList.add('show');
    });

    // ==================== FORM SUBMISSION ====================
    signupForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Clear previous errors
      clearError(nameError);
      clearError(emailError);
      clearError(passwordError);
      clearError(formError);

      const name = nameInput.value.trim();
      const email = emailInput.value.trim();
      const password = passwordInput.value;

      // Validation
      let isValid = true;

      if (!name) {
        showError(nameError, 'Name is required');
        isValid = false;
      } else if (name.length < 2) {
        showError(nameError, 'Name must be at least 2 characters');
        isValid = false;
      }

      if (!email) {
        showError(emailError, 'Email is required');
        isValid = false;
      } else if (!validateEmail(email)) {
        showError(emailError, 'Please enter a valid email');
        isValid = false;
      }

      if (!password) {
        showError(passwordError, 'Password is required');
        isValid = false;
      } else if (!checkPasswordStrength(password)) {
        showError(passwordError, 'Please meet all password requirements');
        isValid = false;
      }

      if (!isValid) return;

      // Add loading state
      const submitBtn = signupForm.querySelector('button[type="submit"]');
      submitBtn.classList.add('loading');
      submitBtn.disabled = true;

      try {
        const response = await window.Auth.register(name, email, password);
        const data = await response.json().catch(() => ({}));

        if (response.ok) {
          // Cookie set by backend; navigate to absolute project path
          window.location.href = `${window.location.origin}/tracklet-public/dashboard.html`;
        } else {
          showError(formError, data.error || 'Signup failed. Please try again.');
        }
      } catch (error) {
        console.error('Signup error:', error);
        showError(formError, 'An error occurred. Please try again later.');
      } finally {
        submitBtn.classList.remove('loading');
        submitBtn.disabled = false;
      }
    });

        // ==================== HANDLE OAUTH CALLBACK ====================
    // Extract token from URL if coming from OAuth redirect
    // OAuth callback no longer reads token from URL; rely on backend cookie
    // Optionally clean query params if present
    (function cleanQuery() {
      if (window.location.search) {
        window.history.replaceState({}, document.title, 'signup.html');
      }
    })();

    // ==================== THEME TOGGLE ====================
    // ... rest of code stays the same ...

    // ==================== FORM SUBMISSION ====================
    // (Removed duplicate signup handler; consolidated above)

    // ==================== GOOGLE OAUTH ====================
    googleSignupBtn.addEventListener('click', () => {
      const redirectUri = `${window.location.origin}/tracklet-public/dashboard.html`;
      window.location.href = `${window.Auth.API_URL}/auth/google?redirect_uri=${encodeURIComponent(redirectUri)}`;
    });

    // ==================== AUTOFILL EMAIL FROM URL ====================
    // Check if email parameter exists in URL and autofill
    const urlParams = new URLSearchParams(window.location.search);
    const emailParam = urlParams.get('email');
    if (emailParam) {
      emailInput.value = emailParam;
      emailInput.focus();
      // Move cursor to end of input
      emailInput.setSelectionRange(emailParam.length, emailParam.length);
    }
  </script>
</body>
</html>
